{% extends "base.html" %} {% block title %}Synthia | Results{% endblock %} {%
block content %}
<section class="hero compact" data-animate="rise">
  <p class="eyebrow">Latest Generation Run</p>
  <h1 class="page-title">Results Dashboard</h1>
  <p class="lead">
    Dataset ID: <code>{{ run.dataset_id }}</code> {% if run.config.disease %}
    <span class="text-muted">for {{ run.config.disease }}</span>
    {% endif %}
  </p>
</section>

<section class="kpi-grid" data-animate="rise">
  <article class="kpi-card">
    <p class="kpi-label">Model</p>
    <p class="kpi-value">{{ run.config.model_type }}</p>
  </article>
  <article class="kpi-card">
    <p class="kpi-label">Records Generated</p>
    <p class="kpi-value metric-value" data-countup="{{ run.n_generated }}">
      {{ run.n_generated }}
    </p>
  </article>
  <article class="kpi-card">
    <p class="kpi-label">Quality Score</p>
    <p
      class="kpi-value metric-value"
      data-countup="{{ '%.4f'|format(run.validation.quality_score) }}"
    >
      {{ "%.4f"|format(run.validation.quality_score) }}
    </p>
  </article>
  <article class="kpi-card">
    <p class="kpi-label">Privacy Score</p>
    <p
      class="kpi-value metric-value"
      data-countup="{{ '%.4f'|format(run.privacy.score) }}"
    >
      {{ "%.4f"|format(run.privacy.score) }}
    </p>
  </article>
</section>

<section class="section-block" data-animate="slide">
  <div class="section-head">
    <h2>Validation Metrics</h2>
    <p>Distribution alignment and predictive utility against real test data.</p>
  </div>
  <article class="card">
    <div class="metric-grid">
      <div class="metric">
        <p class="metric-label">Mean KS Statistic</p>
        <p class="metric-value">{{ "%.4f"|format(run.validation.mean_ks) }}</p>
      </div>
      <div class="metric">
        <p class="metric-label">Mean JSD</p>
        <p class="metric-value">{{ "%.4f"|format(run.validation.mean_jsd) }}</p>
      </div>
      <div class="metric">
        <p class="metric-label">Max JSD</p>
        <p class="metric-value">{{ "%.4f"|format(run.validation.max_jsd) }}</p>
      </div>
      <div class="metric">
        <p class="metric-label">Correlation Similarity</p>
        {% if run.validation.corr_sim is not none %}
        <p class="metric-value">{{ "%.4f"|format(run.validation.corr_sim) }}</p>
        {% else %}
        <p class="metric-value">N/A</p>
        {% endif %}
      </div>
    </div>

    <h3 class="subhead">ML Utility (Synthetic to Real)</h3>
    <div class="metric-grid compact">
      <div class="metric">
        <p class="metric-label">Accuracy</p>
        <p class="metric-value">{{ "%.4f"|format(run.validation.accuracy) }}</p>
      </div>
      <div class="metric">
        <p class="metric-label">F1 Score</p>
        <p class="metric-value">{{ "%.4f"|format(run.validation.f1) }}</p>
      </div>
      <div class="metric">
        <p class="metric-label">AUC</p>
        <p class="metric-value">{{ "%.4f"|format(run.validation.auc) }}</p>
      </div>
    </div>

    {% if run.validation.js_divergences %}
    <h3 class="subhead">Jensen-Shannon Divergences</h3>
    <div class="table-wrap">
      <table>
        <tr>
          <th>Column</th>
          <th>JSD</th>
          <th>Status</th>
        </tr>
        {% for col, jsd in run.validation.js_divergences.items() %}
        <tr>
          <td>{{ col }}</td>
          <td>{{ "%.4f"|format(jsd) }}</td>
          <td>
            {% if jsd < 0.1 %}
            <span class="status-pill status-good">Good</span>
            {% elif jsd < 0.3 %}
            <span class="status-pill status-moderate">Moderate</span>
            {% else %}
            <span class="status-pill status-high">High</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </table>
    </div>
    {% endif %} {% if run.validation.collapse_info %}
    <h3 class="subhead">Mode Collapse Indicators</h3>
    <div class="table-wrap">
      <table>
        <tr>
          <th>Column</th>
          <th>Dominant Class</th>
          <th>Frequency</th>
          <th>Unique Values</th>
        </tr>
        {% for col, info in run.validation.collapse_info.items() %}
        <tr>
          <td>{{ col }}</td>
          <td>{{ info.dominant_class }}</td>
          <td>{{ "%.1f%%"|format(info.dominant_frequency * 100) }}</td>
          <td>{{ info.n_unique }}</td>
        </tr>
        {% endfor %}
      </table>
    </div>
    {% endif %}
  </article>
</section>

<section class="section-block" data-animate="slide">
  <div class="section-head">
    <h2>Privacy Analysis</h2>
    <p>Nearest-neighbor distance and high-risk record summary.</p>
  </div>
  <article class="card">
    <div class="metric-grid">
      <div class="metric">
        <p class="metric-label">Mean NND</p>
        <p class="metric-value">{{ "%.4f"|format(run.privacy.nnd.mean) }}</p>
      </div>
      <div class="metric">
        <p class="metric-label">Min NND</p>
        <p class="metric-value">{{ "%.4f"|format(run.privacy.nnd.min) }}</p>
      </div>
      <div class="metric">
        <p class="metric-label">High-Risk Records</p>
        <p class="metric-value">
          {{ run.privacy.risk.high_risk_count }} / {{ run.n_generated }}
        </p>
      </div>
      <div class="metric">
        <p class="metric-label">High-Risk Percentage</p>
        <p class="metric-value">
          {{ "%.1f%%"|format(run.privacy.risk.high_risk_percentage * 100) }}
        </p>
      </div>
    </div>
  </article>
</section>

<section class="section-block" data-animate="slide">
  <div class="section-head">
    <h2>Bias Analysis</h2>
    <p>Distribution drift, amplification checks, and mitigation guidance.</p>
  </div>
  <article class="card">
    {% if run.bias.feature_distributions %}
    <h3 class="subhead">Feature Distribution Bias</h3>
    <div class="table-wrap">
      <table>
        <tr>
          <th>Column</th>
          <th>JSD</th>
          <th>Status</th>
        </tr>
        {% for col, info in run.bias.feature_distributions.items() %}
        <tr>
          <td>{{ col }}</td>
          <td>{{ "%.4f"|format(info.jsd) }}</td>
          <td>
            {% if info.status == 'low' %}
            <span class="status-pill status-good">Low</span>
            {% elif info.status == 'moderate' %}
            <span class="status-pill status-moderate">Moderate</span>
            {% else %}
            <span class="status-pill status-high">High</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </table>
    </div>
    {% endif %} {% if run.bias.amplification.flagged %}
    <h3 class="subhead">Amplified Columns</h3>
    <div class="table-wrap">
      <table>
        <tr>
          <th>Column</th>
          <th>Real Ratio</th>
          <th>Synthetic Ratio</th>
        </tr>
        {% for col in run.bias.amplification.flagged %} {% set info =
        run.bias.amplification.columns[col] %}
        <tr>
          <td>{{ col }}</td>
          <td>{{ "%.2f"|format(info.real_imbalance_ratio) }}</td>
          <td>{{ "%.2f"|format(info.synthetic_imbalance_ratio) }}</td>
        </tr>
        {% endfor %}
      </table>
    </div>
    {% endif %} {% if run.bias.recommendations %}
    <h3 class="subhead">Recommendations</h3>
    <ul class="note-list">
      {% for rec in run.bias.recommendations %}
      <li>{{ rec }}</li>
      {% endfor %}
    </ul>
    {% endif %} {% if not run.bias.feature_distributions and not
    run.bias.amplification.flagged and not run.bias.recommendations %}
    <p class="text-muted">No significant bias indicators were reported.</p>
    {% endif %}
  </article>
</section>

<section class="section-block" data-animate="rise">
  <div class="section-head">
    <h2>Synthetic Data Preview</h2>
    <p>First 20 generated rows for quick inspection.</p>
  </div>
  <article class="card preview-card">
    <div class="table-wrap">
      <table>
        <tr>
          {% for col in run.synthetic_columns %}
          <th>{{ col }}</th>
          {% endfor %}
        </tr>
        {% for row in run.synthetic_preview %}
        <tr>
          {% for col in run.synthetic_columns %}
          <td>{{ row[col] }}</td>
          {% endfor %}
        </tr>
        {% endfor %}
      </table>
    </div>
  </article>
</section>

<div class="button-row results-actions" data-animate="rise">
  <a href="{{ url_for('datasets') }}" class="btn btn-secondary"
    >View All Datasets</a
  >
  <a href="{{ url_for('index') }}" class="btn btn-primary">Generate Again</a>
</div>
{% endblock %}
