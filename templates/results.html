{% extends "base.html" %} {% block title %}Synthia - Results{% endblock %} {%
block content %}

<h2 class="section-title">Generation Summary</h2>
<div class="metrics">
  <div class="metric-box">
    <div class="value">{{ run.config.model_type }}</div>
    <div class="label">Model</div>
  </div>
  <div class="metric-box">
    <div class="value">{{ run.n_generated }}</div>
    <div class="label">Records Generated</div>
  </div>
  <div class="metric-box">
    <div class="value">{{ "%.4f"|format(run.validation.quality_score) }}</div>
    <div class="label">Quality Score</div>
  </div>
  <div class="metric-box">
    <div class="value">{{ "%.4f"|format(run.privacy.score) }}</div>
    <div class="label">Privacy Score</div>
  </div>
</div>

<!-- Validation -->
<h2 class="section-title">Validation Metrics</h2>
<div class="card">
  <div class="metrics mb-1">
    <div class="metric-box">
      <div class="value">{{ "%.4f"|format(run.validation.mean_ks) }}</div>
      <div class="label">Mean KS Statistic</div>
    </div>
    <div class="metric-box">
      <div class="value">{{ "%.4f"|format(run.validation.mean_jsd) }}</div>
      <div class="label">Mean JSD</div>
    </div>
    <div class="metric-box">
      <div class="value">{{ "%.4f"|format(run.validation.max_jsd) }}</div>
      <div class="label">Max JSD</div>
    </div>
    <div class="metric-box">
      {% if run.validation.corr_sim is not none %}
      <div class="value">{{ "%.4f"|format(run.validation.corr_sim) }}</div>
      {% else %}
      <div class="value">N/A</div>
      {% endif %}
      <div class="label">Correlation Similarity</div>
    </div>
  </div>

  <h3 class="text-sm" style="margin-top: 1rem">
    ML Utility (Synthetic to Real)
  </h3>
  <div class="metrics mt-1">
    <div class="metric-box">
      <div class="value">{{ "%.4f"|format(run.validation.accuracy) }}</div>
      <div class="label">Accuracy</div>
    </div>
    <div class="metric-box">
      <div class="value">{{ "%.4f"|format(run.validation.f1) }}</div>
      <div class="label">F1 Score</div>
    </div>
    <div class="metric-box">
      <div class="value">{{ "%.4f"|format(run.validation.auc) }}</div>
      <div class="label">AUC</div>
    </div>
  </div>

  {% if run.validation.js_divergences %}
  <h3 class="text-sm" style="margin-top: 1rem">Jensen-Shannon Divergences</h3>
  <div class="table-wrap mt-1">
    <table>
      <tr>
        <th>Column</th>
        <th>JSD</th>
        <th>Status</th>
      </tr>
      {% for col, jsd in run.validation.js_divergences.items() %}
      <tr>
        <td>{{ col }}</td>
        <td>{{ "%.4f"|format(jsd) }}</td>
        <td>
          {% if jsd < 0.1 %}
          <span class="badge badge-good">Good</span>
          {% elif jsd < 0.3 %}
          <span class="badge badge-moderate">Moderate</span>
          {% else %}
          <span class="badge badge-high">High</span>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </table>
  </div>
  {% endif %} {% if run.validation.collapse_info %}
  <h3 class="text-sm" style="margin-top: 1rem">Mode Collapse Detected</h3>
  <div class="table-wrap mt-1">
    <table>
      <tr>
        <th>Column</th>
        <th>Dominant Class</th>
        <th>Frequency</th>
        <th>Unique Values</th>
      </tr>
      {% for col, info in run.validation.collapse_info.items() %}
      <tr>
        <td>{{ col }}</td>
        <td>{{ info.dominant_class }}</td>
        <td>{{ "%.1f%%"|format(info.dominant_frequency * 100) }}</td>
        <td>{{ info.n_unique }}</td>
      </tr>
      {% endfor %}
    </table>
  </div>
  {% endif %}
</div>

<!-- Privacy -->
<h2 class="section-title">Privacy Analysis</h2>
<div class="card">
  <div class="metrics">
    <div class="metric-box">
      <div class="value">{{ "%.4f"|format(run.privacy.nnd.mean) }}</div>
      <div class="label">Mean NND</div>
    </div>
    <div class="metric-box">
      <div class="value">{{ "%.4f"|format(run.privacy.nnd.min) }}</div>
      <div class="label">Min NND</div>
    </div>
    <div class="metric-box">
      <div class="value">
        {{ run.privacy.risk.high_risk_count }} / {{ run.n_generated }}
      </div>
      <div class="label">High-Risk Records</div>
    </div>
    <div class="metric-box">
      <div class="value">
        {{ "%.1f%%"|format(run.privacy.risk.high_risk_percentage * 100) }}
      </div>
      <div class="label">High-Risk %</div>
    </div>
  </div>
</div>

<!-- Bias -->
<h2 class="section-title">Bias Analysis</h2>
<div class="card">
  {% if run.bias.feature_distributions %}
  <h3 class="text-sm">Feature Distribution Bias</h3>
  <div class="table-wrap mt-1 mb-1">
    <table>
      <tr>
        <th>Column</th>
        <th>JSD</th>
        <th>Status</th>
      </tr>
      {% for col, info in run.bias.feature_distributions.items() %}
      <tr>
        <td>{{ col }}</td>
        <td>{{ "%.4f"|format(info.jsd) }}</td>
        <td>
          {% if info.status == 'low' %}
          <span class="badge badge-good">Low</span>
          {% elif info.status == 'moderate' %}
          <span class="badge badge-moderate">Moderate</span>
          {% else %}
          <span class="badge badge-high">High</span>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </table>
  </div>
  {% endif %} {% if run.bias.amplification.flagged %}
  <h3 class="text-sm">Amplified Columns</h3>
  <div class="table-wrap mt-1 mb-1">
    <table>
      <tr>
        <th>Column</th>
        <th>Real Ratio</th>
        <th>Synthetic Ratio</th>
      </tr>
      {% for col in run.bias.amplification.flagged %} {% set info =
      run.bias.amplification.columns[col] %}
      <tr>
        <td>{{ col }}</td>
        <td>{{ "%.2f"|format(info.real_imbalance_ratio) }}</td>
        <td>{{ "%.2f"|format(info.synthetic_imbalance_ratio) }}</td>
      </tr>
      {% endfor %}
    </table>
  </div>
  {% endif %} {% if run.bias.recommendations %}
  <h3 class="text-sm">Recommendations</h3>
  <ul class="mt-1 text-sm" style="padding-left: 1.5rem">
    {% for rec in run.bias.recommendations %}
    <li>{{ rec }}</li>
    {% endfor %}
  </ul>
  {% endif %}
</div>

<!-- Data Preview -->
<h2 class="section-title">Synthetic Data Preview (first 20 rows)</h2>
<div class="card">
  <div class="table-wrap">
    <table>
      <tr>
        {% for col in run.synthetic_columns %}
        <th>{{ col }}</th>
        {% endfor %}
      </tr>
      {% for row in run.synthetic_preview %}
      <tr>
        {% for col in run.synthetic_columns %}
        <td>{{ row[col] }}</td>
        {% endfor %}
      </tr>
      {% endfor %}
    </table>
  </div>
</div>

<div class="mt-2">
  <a href="{{ url_for('datasets') }}" class="btn btn-outline"
    >View All Datasets</a
  >
  <a href="{{ url_for('index') }}" class="btn" style="margin-left: 0.5rem"
    >Generate Again</a
  >
</div>

{% endblock %}
